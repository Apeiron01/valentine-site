<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sevgililer Günü</title>

  <style>
    :root{
      --bg:#f4c9d6; --stroke:rgba(111,74,164,.25);
      --text:#3b2358; --muted:rgba(59,35,88,.7);
      --purple:#7a4bb7; --pink:#f08db2;

      --pass-bg1:#0f0d16; --pass-bg2:#0b0912;
      --pass-stroke:rgba(183,155,223,.28);
      --pass-text:#f6effa; --pass-muted:rgba(246,239,250,.72);

      --gate-stroke:rgba(183,155,223,.28);
      --gate-text:#f6effa; --gate-muted:rgba(246,239,250,.72);
      --gate-accent2:#f08db2;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow-x:hidden;
      background: var(--pass-bg1);
      color: var(--pass-text);
    }

    /* ===== PASSWORD ===== */
    .pass{
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:clamp(16px,3vw,32px);
      position:fixed; inset:0; z-index:99999;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(183,155,223,.20), transparent 55%),
        radial-gradient(900px 700px at 80% 30%, rgba(240,141,178,.16), transparent 55%),
        radial-gradient(1000px 800px at 40% 90%, rgba(122,75,183,.18), transparent 60%),
        linear-gradient(180deg, var(--pass-bg1), var(--pass-bg2));
    }
    .passCard{
      width:min(620px,100%);
      border-radius:26px;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--pass-stroke);
      box-shadow:0 30px 90px rgba(0,0,0,.55);
      backdrop-filter:blur(12px);
      overflow:hidden;
    }
    .passHeader{
      padding:clamp(18px,3vw,26px);
      border-bottom:1px solid rgba(183,155,223,.18);
      background:linear-gradient(90deg, rgba(183,155,223,.12), rgba(240,141,178,.10));
    }
    .passTitle{
      margin:0; font-weight:950; letter-spacing:.6px; text-transform:uppercase;
      font-size:clamp(18px,3vw,26px);
    }
    .passBody{ padding:clamp(18px,3vw,26px); display:grid; gap:12px; }
    .passRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .passInput{
      flex:1 1 240px; min-width:220px;
      padding:14px; border-radius:16px;
      border:1px solid rgba(183,155,223,.28);
      background:rgba(0,0,0,.18);
      color:var(--pass-text); outline:none;
      font-weight:850; letter-spacing:.25px;
    }
    .passInput::placeholder{ color:rgba(246,239,250,.45); font-weight:700; }
    .passBtn{
      appearance:none; border:1px solid rgba(183,155,223,.35);
      background:linear-gradient(180deg, rgba(183,155,223,.20), rgba(240,141,178,.14));
      color:var(--pass-text);
      padding:13px 14px; border-radius:16px; cursor:pointer;
      font-weight:950; letter-spacing:.3px;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
      user-select:none;
    }
    .passBtn:hover{ transform:translateY(-1px); box-shadow:0 16px 30px rgba(0,0,0,.35); filter:brightness(1.05); }
    .passMsg{
      font-size:12px; font-weight:900; letter-spacing:.2px;
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(183,155,223,.2);
      background:rgba(255,255,255,.06);
      color:var(--pass-muted);
      display:none;
    }
    .passMsg.err{
      border-color:rgba(255,90,135,.35);
      color:rgba(255,90,135,.95);
      background:rgba(255,90,135,.08);
      display:block;
    }

    /* ===== GATE ===== */
    .gate{
      min-height:100vh; display:none; align-items:center; justify-content:center;
      padding:clamp(16px,3vw,32px);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(183,155,223,.20), transparent 55%),
        radial-gradient(900px 700px at 80% 30%, rgba(240,141,178,.16), transparent 55%),
        radial-gradient(1000px 800px at 40% 90%, rgba(122,75,183,.18), transparent 60%),
        linear-gradient(180deg, #0f0d16, #0b0912);
    }
    .gateCard{
      width:min(720px,100%);
      border-radius:28px;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--gate-stroke);
      box-shadow:0 30px 90px rgba(0,0,0,.55);
      backdrop-filter:blur(12px);
      overflow:hidden;
    }
    .gateHeader{
      padding:clamp(18px,3vw,28px);
      border-bottom:1px solid rgba(183,155,223,.18);
      background:linear-gradient(90deg, rgba(183,155,223,.12), rgba(240,141,178,.10));
    }
    .gateTitle{ margin:0; font-weight:950; letter-spacing:.6px; text-transform:uppercase; font-size:clamp(20px,3vw,30px); }
    .gateBody{ padding:clamp(18px,3vw,28px); display:grid; gap:14px; }
    .gatePrompt{
      border:1px solid rgba(183,155,223,.18);
      background:rgba(255,255,255,.06);
      border-radius:20px; padding:14px;
    }
    .gatePrompt .q{ margin:0; font-weight:900; letter-spacing:.2px; font-size:14px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .input{
      flex:1 1 240px; min-width:220px;
      padding:14px; border-radius:16px;
      border:1px solid rgba(183,155,223,.28);
      background:rgba(0,0,0,.18);
      color:var(--gate-text); outline:none;
      font-weight:800; letter-spacing:.25px;
    }
    .input::placeholder{ color:rgba(246,239,250,.45); font-weight:700; }
    .btn{
      appearance:none; border:1px solid rgba(183,155,223,.35);
      background:linear-gradient(180deg, rgba(183,155,223,.20), rgba(240,141,178,.14));
      color:var(--gate-text);
      padding:13px 14px; border-radius:16px; cursor:pointer;
      font-weight:950; letter-spacing:.3px;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 16px 30px rgba(0,0,0,.35); filter:brightness(1.05); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }
    .msg{
      font-size:12px; font-weight:900; letter-spacing:.2px;
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(183,155,223,.2);
      background:rgba(255,255,255,.06);
      color:var(--gate-muted);
      display:none;
    }
    .msg.err{
      border-color:rgba(255,90,135,.35);
      color:rgba(255,90,135,.95);
      background:rgba(255,90,135,.08);
      display:block;
    }
    .msg.ok{
      border-color:rgba(78,240,182,.35);
      color:rgba(78,240,182,.95);
      background:rgba(78,240,182,.08);
      display:block;
    }

    .gateLoader{
      display:none;
      padding:26px 18px 30px;
      border-top:1px solid rgba(183,155,223,.18);
      background:rgba(0,0,0,.10);
    }
    .gateLoaderTop{ display:flex; align-items:center; justify-content:center; flex-direction:column; gap:12px; text-align:center; }
    .gateLoaderTop .okText{ font-weight:950; letter-spacing:.35px; color:rgba(78,240,182,.95); font-size:14px; }
    .gateLoaderTop .sub{ font-size:12px; color:var(--gate-muted); }

    /* Heart loader */
    .cssload-main{ position:relative; width:160px; height:140px; margin:10px auto 0; transform:translateZ(0); }
    .cssload-main *{ font-size:62px; }
    .cssload-heart{ animation:cssload-heart 2.88s cubic-bezier(0.75,0,0.5,1) infinite normal; top:50%; left:50%; position:absolute; transform:translate(-50%,-50%); }
    .cssload-heartL,.cssload-heartR{
      width:1em; height:1em; border:1px solid var(--gate-accent2); background-color:var(--gate-accent2);
      position:absolute; display:block; border-radius:100%; box-shadow:0 20px 40px rgba(0,0,0,.35);
    }
    .cssload-heartL{ animation:cssload-heartL 2.88s cubic-bezier(0.75,0,0.5,1) infinite normal; transform:translate(-28px,-27px); }
    .cssload-heartR{ animation:cssload-heartR 2.88s cubic-bezier(0.75,0,0.5,1) infinite normal; transform:translate(28px,-27px); }
    .cssload-square{
      width:1em; height:1em; border:1px solid var(--gate-accent2); background-color:var(--gate-accent2);
      position:relative; display:block; transform:scale(1) rotate(-45deg);
      animation:cssload-square 2.88s cubic-bezier(0.75,0,0.5,1) infinite normal;
      box-shadow:0 20px 40px rgba(0,0,0,.35);
    }
    .cssload-shadow{
      top:97px; left:50%; position:absolute; transform:translateX(-50%);
      width:1em; height:.24em; background-color:rgba(246,239,250,.22);
      border:1px solid rgba(246,239,250,.18); border-radius:50%;
      animation:cssload-shadow 2.88s cubic-bezier(0.75,0,0.5,1) infinite normal;
    }
    @keyframes cssload-square{50%{border-radius:100%; transform:scale(.5) rotate(-45deg);}100%{transform:scale(1) rotate(-45deg);} }
    @keyframes cssload-heart{50%{transform:translate(-50%,-50%) rotate(360deg);}100%{transform:translate(-50%,-50%) rotate(720deg);} }
    @keyframes cssload-heartL{60%{transform:translate(-28px,-27px) scale(.4);} }
    @keyframes cssload-heartR{40%{transform:translate(28px,-27px) scale(.4);} }
    @keyframes cssload-shadow{50%{transform:translateX(-50%) scale(.5); border-color:rgba(246,239,250,.10);} }

    /* ===== MAIN ===== */
    .main{
      display:none; min-height:100vh;
      background:
        radial-gradient(1200px 700px at 25% 15%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(900px 600px at 80% 35%, rgba(183,155,223,.35), transparent 60%),
        radial-gradient(900px 700px at 35% 90%, rgba(240,141,178,.35), transparent 55%),
        var(--bg);
      color:var(--text);
      overflow-x:hidden;
      position:relative;
      isolation:isolate;
    }
    .wrap{
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:clamp(16px,3vw,36px);
      position:relative; z-index:2;
    }
    .card{
      width:min(1000px,100%);
      background:linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,.42));
      border:1px solid var(--stroke);
      backdrop-filter:blur(10px);
      border-radius:24px;
      box-shadow:0 20px 60px rgba(59,35,88,.18);
      overflow:hidden;
      position:relative; z-index:2;
    }
    .topbar{
      padding:clamp(18px,3vw,28px);
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      border-bottom:1px solid rgba(111,74,164,.18);
    }
    .brand{ display:flex; flex-direction:column; gap:6px; min-width:220px; }
    .title{
      margin:0; font-weight:900; letter-spacing:.2px;
      font-size:clamp(24px,3.6vw,44px);
      line-height:1.05;
      text-wrap:balance;
    }
    .content{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:clamp(14px,2.2vw,22px);
      padding:clamp(18px,3vw,28px);
    }
    @media (max-width:860px){ .content{grid-template-columns:1fr;} .brand{min-width:unset;} .topbar{flex-direction:column; align-items:flex-start;} }

    .panel{
      border:1px solid rgba(111,74,164,.18);
      border-radius:20px;
      background:rgba(255,255,255,.35);
      overflow:hidden;
    }
    .panelHeader{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom:1px solid rgba(111,74,164,.15);
      background:linear-gradient(90deg, rgba(183,155,223,.22), rgba(240,141,178,.18));
    }
    .panelHeader h2{
      margin:0; font-size:14px; letter-spacing:.25px; text-transform:uppercase; font-weight:900;
    }
    .pill{
      font-size:12px; font-weight:800;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(111,74,164,.2);
      background:rgba(255,255,255,.35);
    }
    .qa{
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:320px;
    }
    .bubble{
      max-width:92%;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(111,74,164,.16);
      background:rgba(255,255,255,.45);
      box-shadow:0 8px 18px rgba(59,35,88,.08);
    }
    .bubble.me{
      margin-left:auto;
      background:linear-gradient(180deg, rgba(183,155,223,.22), rgba(240,141,178,.16));
    }
    .bubble .k{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; font-weight:700; letter-spacing:.15px; }
    .bubble .v{ font-size:14px; font-weight:800; line-height:1.35; }
    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:auto;
      padding-top:10px;
    }
    .btnMain{
      appearance:none;
      border:1px solid rgba(111,74,164,.25);
      background:rgba(255,255,255,.42);
      color:var(--text);
      padding:11px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.2px;
      font-size:13px;
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
      user-select:none;
    }
    .btnMain:hover{ transform:translateY(-1px); box-shadow:0 10px 20px rgba(59,35,88,.12); background:rgba(255,255,255,.55); }
    .btnMain.primary{
      border-color:rgba(122,75,183,.35);
      background:linear-gradient(180deg, rgba(122,75,183,.20), rgba(240,141,178,.16));
    }

    .albumWrap{ display:flex; flex-direction:column; gap:12px; align-items:center; }
    .albumStage{
      width:min(360px,92vw);
      height:min(360px,92vw);
      position:relative;
      perspective:1200px;
      border-radius:22px;
      border:1px solid rgba(111,74,164,.18);
      background:rgba(255,255,255,.25);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.25), 0 18px 50px rgba(59,35,88,.14);
    }
    .album{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      animation:spin 16s linear infinite;
      will-change: transform;
      cursor:pointer;
      touch-action: manipulation;
    }
    .album.paused{ animation-play-state: paused; }
    .album:hover{ animation-play-state: paused; }
    @keyframes spin{ from{ transform:rotateY(0deg); } to{ transform:rotateY(360deg); } }

    .photo{
      position:absolute; top:50%; left:50%;
      width:78%; height:78%;
      transform-style:preserve-3d;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(111,74,164,.22);
      box-shadow:0 14px 30px rgba(59,35,88,.18);
      background:rgba(255,255,255,.45);
    }
    .photo img{ width:100%; height:100%; object-fit:cover; display:block; filter:saturate(1.08) contrast(1.02); }
    .photo.p1{ transform:translate(-50%,-50%) rotateY(0deg)   translateZ(150px); }
    .photo.p2{ transform:translate(-50%,-50%) rotateY(90deg)  translateZ(150px); }
    .photo.p3{ transform:translate(-50%,-50%) rotateY(180deg) translateZ(150px); }
    .photo.p4{ transform:translate(-50%,-50%) rotateY(270deg) translateZ(150px); }

    /* Decor hearts */
    .decorLayer{ position:absolute; inset:0; pointer-events:none; z-index:1; }
    .decorItem{ position:absolute; opacity:.95; filter:drop-shadow(0 10px 20px rgba(59,35,88,.18)); pointer-events:auto; }
    .heart-container {
      --heart-color: var(--pink);
      position: relative;
      width: 46px; height: 46px;
      transition: .3s;
    }
    .heart-container .checkbox { position:absolute; width:100%; height:100%; opacity:0; z-index:20; cursor:pointer; }
    .heart-container .svg-container { width:100%; height:100%; display:flex; justify-content:center; align-items:center; }
    .heart-container .svg-outline, .heart-container .svg-filled { fill: var(--heart-color); position:absolute; }
    .heart-container .svg-filled { animation: keyframes-svg-filled 1s; display:none; }
    .heart-container .svg-celebrate {
      position:absolute;
      animation: keyframes-svg-celebrate .5s;
      animation-fill-mode: forwards;
      display:none;
      stroke: var(--heart-color);
      fill: var(--heart-color);
      stroke-width: 2px;
    }
    .heart-container .checkbox:checked~.svg-container .svg-filled { display:block }
    .heart-container .checkbox:checked~.svg-container .svg-celebrate { display:block }
    @keyframes keyframes-svg-filled { 0%{transform:scale(0)} 25%{transform:scale(1.2)} 50%{transform:scale(1); filter:brightness(1.25)} }
    @keyframes keyframes-svg-celebrate { 0%{transform:scale(0)} 50%{opacity:1; filter:brightness(1.35)} 100%{transform:scale(1.4); opacity:0; display:none} }

    .finalMain{
      display:none;
      min-height:100vh;
      background:
        radial-gradient(1200px 700px at 25% 15%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(900px 600px at 80% 35%, rgba(183,155,223,.35), transparent 60%),
        radial-gradient(900px 700px at 35% 90%, rgba(240,141,178,.35), transparent 55%),
        var(--bg);
      color:var(--text);
      position:relative;
      isolation:isolate;
    }
    .finalWrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:clamp(16px,3vw,36px);
      position:relative;
      z-index:2;
    }
    .finalCard{
      width:min(520px,100%);
      border-radius:24px;
      background:linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,.42));
      border:1px solid var(--stroke);
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(59,35,88,.18);
      padding: 24px;
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:center;
      justify-content:center;
    }
    .finalText{
      font-weight:950;
      letter-spacing:.2px;
      font-size: clamp(24px, 4vw, 36px);
      line-height:1.05;
    }
    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <!-- PASSWORD -->
  <section class="pass" id="pass">
    <div class="passCard">
      <div class="passHeader">
        <h1 class="passTitle">DUR! BU SİTE SADECE 1 KİŞİYE ÖZEL</h1>
      </div>
      <div class="passBody">
        <div class="passRow">
          <input class="passInput" id="passInput" type="password" placeholder="Şifre" />
          <button class="passBtn" id="passBtn">Giriş</button>
        </div>
        <div class="passMsg" id="passErr">Yanlış şifre.</div>
      </div>
    </div>
  </section>

  <!-- GATE -->
  <section class="gate" id="gate">
    <div class="gateCard">
      <div class="gateHeader">
        <h1 class="gateTitle">DUR! BU SİTE SADECE 1 KİŞİYE ÖZEL</h1>
      </div>

      <div class="gateBody" id="gateBody">
        <div class="gatePrompt">
          <p class="q">Tanışma tarihimiz nedir?</p>
        </div>

        <div class="row" id="gateForm">
          <input class="input" id="dateInput" autocomplete="off" placeholder="Örn: 13 şubat / 13/02 / 13.02" />
          <button class="btn" id="btnCheck">Kontrol et</button>
        </div>

        <div class="row">
          <div class="msg err" id="errMsg">Yanlış. Tekrar dene.</div>
          <div class="msg ok" id="okMsg">Doğru cevap.</div>
        </div>

        <div class="gateLoader" id="gateLoader">
          <div class="gateLoaderTop">
            <div class="okText">Doğru cevap.</div>
            <div class="sub">Hazırlanıyor…</div>
          </div>

          <div class="cssload-main" aria-hidden="true">
            <div class="cssload-heart">
              <span class="cssload-heartL"></span>
              <span class="cssload-heartR"></span>
              <span class="cssload-square"></span>
            </div>
            <div class="cssload-shadow"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN (QUESTIONS) -->
  <main class="main" id="main">
    <div class="decorLayer" id="decorLayer" aria-hidden="true"></div>

    <div class="wrap">
      <div class="card">
        <div class="topbar">
          <div class="brand">
            <h1 class="title">Sevgililer günün kutlu olsun aşkım</h1>
          </div>
        </div>

        <div class="content">
          <section class="panel" aria-label="Soru cevap">
            <div class="panelHeader">
              <h2>Sorular</h2>
              <div class="pill" id="scorePill">0 / 5</div>
            </div>

            <div class="qa" id="qa">
              <div class="actions">
                <button class="btnMain primary" id="btnNext">Devam</button>
                <button class="btnMain" id="btnFinish">Finish</button>
                <button class="btnMain" id="btnReplay">Baştan</button>
              </div>
            </div>
          </section>

          <aside class="albumWrap" aria-label="Fotoğraf albümü">
            <div class="albumStage">
              <div class="album" id="albumMain" aria-label="3D dönen fotoğraflar">
                <div class="photo p1"><img src="photo1.jpeg" alt="Fotoğraf 1"></div>
                <div class="photo p2"><img src="photo2.jpeg" alt="Fotoğraf 2"></div>
                <div class="photo p3"><img src="photo3.jpeg" alt="Fotoğraf 3"></div>
                <div class="photo p4"><img src="photo4.jpeg" alt="Fotoğraf 4"></div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>
  </main>

  <!-- FINAL (ONLY ALBUM + TEXT) -->
  <section class="finalMain" id="finalMain">
    <div class="decorLayer" id="decorLayerFinal" aria-hidden="true"></div>
    <div class="finalWrap">
      <div class="finalCard">
        <div class="finalText">Seni Çok Seviyorum</div>
        <div class="albumStage" aria-label="Final albüm">
          <div class="album" id="albumFinal" aria-label="3D dönen fotoğraflar (final)">
            <div class="photo p1"><img src="photo1.jpeg" alt="Fotoğraf 1"></div>
            <div class="photo p2"><img src="photo2.jpeg" alt="Fotoğraf 2"></div>
            <div class="photo p3"><img src="photo3.jpeg" alt="Fotoğraf 3"></div>
            <div class="photo p4"><img src="photo4.jpeg" alt="Fotoğraf 4"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // =============================
    // 1) PASSWORD
    // =============================
    const PASSWORD = "Alihan"; // şifre

    const pass = document.getElementById("pass");
    const passInput = document.getElementById("passInput");
    const passBtn = document.getElementById("passBtn");
    const passErr = document.getElementById("passErr");
    const gate = document.getElementById("gate");

    function tryPass(){
      const v = (passInput.value || "").trim();
      if(v === PASSWORD){
        pass.style.display = "none";
        gate.style.display = "flex";
      } else {
        passErr.classList.add("err");
        passErr.style.display = "block";
      }
    }
    passBtn.addEventListener("click", tryPass);
    passInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter") tryPass(); });

    // =============================
    // 2) GATE (13 Şubat)
    // =============================
    const dateInput  = document.getElementById("dateInput");
    const btnCheck   = document.getElementById("btnCheck");
    const errMsg     = document.getElementById("errMsg");
    const okMsg      = document.getElementById("okMsg");
    const gateForm   = document.getElementById("gateForm");
    const gateLoader = document.getElementById("gateLoader");
    const main       = document.getElementById("main");

    function norm(s){
      return (s || "")
        .toString()
        .trim()
        .toLowerCase()
        .replace(/ı/g, "i")
        .replace(/ş/g, "s")
        .replace(/ğ/g, "g")
        .replace(/ü/g, "u")
        .replace(/ö/g, "o")
        .replace(/ç/g, "c")
        .replace(/[^\p{L}\p{N}]+/gu, " ")
        .replace(/\s+/g, " ")
        .trim();
    }

    function isCorrect(input){
      const n = norm(input);

      const monthOk = n.includes("subat") || n.includes("feb") || n.includes("february");
      if ((n.startsWith("13") || n.includes(" 13 ")) && monthOk) return true;

      const justNums = n.replace(/[^\d ]/g, "").replace(/\s+/g, " ").trim();
      if (justNums === "13 02" || justNums === "13 2") return true;

      const compact = (input || "").toString().replace(/[^\d]/g, "");
      if (compact === "1302") return true;

      const parts = justNums.split(" ").filter(Boolean);
      if (parts.length >= 2 && parts[0] === "13" && (parts[1] === "2" || parts[1] === "02")) return true;

      return false;
    }

    function setMsg(which){
      errMsg.style.display = (which === "err") ? "block" : "none";
      okMsg.style.display  = (which === "ok")  ? "block" : "none";
    }

    function lockGateAndLoad(){
      setMsg("ok");
      gateForm.classList.add("hidden");
      gateLoader.style.display = "block";
      dateInput.disabled = true;
      btnCheck.disabled = true;

      setTimeout(() => {
        gate.style.display = "none";
        main.style.display = "block";
        placeDecor(document.getElementById("decorLayer"));
        renderStep();
      }, 2500);
    }

    function checkAnswer(){
      const val = dateInput.value;
      if (isCorrect(val)) lockGateAndLoad();
      else setMsg("err");
    }

    btnCheck.addEventListener("click", checkAnswer);
    dateInput.addEventListener("keydown", (e) => { if(e.key === "Enter") checkAnswer(); });

    // =============================
    // 3) QUESTIONS
    // =============================
    const steps = [
      { q:"Soru 1", ask:"Bugün benden bir şey iste:", choices:["Sarılma","Bir öpücük","Beraber yürüyüş","Beraber kahve"] },
      { q:"Soru 2", ask:"Bizim en iyi ‘ritüelimiz’ hangisi?", choices:["Gece konuşmaları","Film/seri","Spontane plan","Aynı şarkıyı açmak"] },
      { q:"Soru 3", ask:"Beni tek kelimeyle özetle:", choices:["Güven","Heyecan","Sakinlik","Tutku"] },
      { q:"Soru 4", ask:"Bu sene birlikte bir hedef seçelim:", choices:["Yeni bir şehir","Yeni bir hobi","Daha çok fotoğraf","Daha çok ‘biz’ zamanı"] },
      { q:"Soru 5", ask:"Son soru:", choices:["Asla","İmkansız","Hayır","Kesinlikle hayır"] }
    ];

    const qa        = document.getElementById("qa");
    const scorePill = document.getElementById("scorePill");
    const btnNext   = document.getElementById("btnNext");
    const btnFinish = document.getElementById("btnFinish");
    const btnReplay = document.getElementById("btnReplay");

    let idx = 0;
    let answered = 0;
    let lastChoice = null;

    function bubbleHTML(kind, k, v){
      const cls = kind === "me" ? "bubble me" : "bubble";
      return `
        <div class="${cls}">
          <span class="k">${k}</span>
          <div class="v">${v}</div>
        </div>
      `;
    }

    function renderStep(){
      qa.querySelectorAll(".bubble, .choiceGrid").forEach(el => el.remove());

      const s = steps[idx];
      scorePill.textContent = `${answered} / ${steps.length}`;

      qa.insertAdjacentHTML("afterbegin", bubbleHTML("bot", s.q, s.ask));

      const grid = document.createElement("div");
      grid.className = "choiceGrid";
      grid.style.display = "grid";
      grid.style.gridTemplateColumns = "repeat(2, minmax(0, 1fr))";
      grid.style.gap = "10px";
      grid.style.marginTop = "6px";

      const mq = window.matchMedia("(max-width: 420px)");
      const applyCols = () => grid.style.gridTemplateColumns = mq.matches ? "1fr" : "repeat(2, minmax(0, 1fr))";
      mq.addEventListener?.("change", applyCols);
      applyCols();

      s.choices.forEach((c) => {
        const b = document.createElement("button");
        b.className = "btnMain";
        b.textContent = c;
        b.onclick = () => choose(c);
        grid.appendChild(b);
      });

      qa.insertBefore(grid, qa.querySelector(".actions"));

      btnNext.disabled = true;
      btnNext.style.opacity = .55;
      btnNext.style.cursor = "not-allowed";

      // Finish sadece en sonda aktif
      btnFinish.disabled = idx !== steps.length-1;
      btnFinish.style.opacity = btnFinish.disabled ? .55 : 1;
      btnFinish.style.cursor  = btnFinish.disabled ? "not-allowed" : "pointer";
    }

    function choose(choice){
      if(lastChoice && lastChoice === choice) return;
      lastChoice = choice;

      qa.insertAdjacentHTML("beforeend", bubbleHTML("me", "Cevabın", choice));
      answered = Math.min(steps.length, idx+1);
      scorePill.textContent = `${answered} / ${steps.length}`;

      btnNext.disabled = false;
      btnNext.style.opacity = 1;
      btnNext.style.cursor = "pointer";

      if(idx === steps.length-1){
        btnFinish.disabled = false;
        btnFinish.style.opacity = 1;
        btnFinish.style.cursor = "pointer";
      }
    }

    btnNext.addEventListener("click", () => {
      if(idx < steps.length-1){
        idx++;
        lastChoice = null;
        renderStep();
      }
    });

    btnReplay.addEventListener("click", () => {
      idx = 0;
      answered = 0;
      lastChoice = null;
      renderStep();
    });

    // =============================
    // 4) FINISH -> FINAL SCREEN
    // =============================
    const finalMain = document.getElementById("finalMain");

    function goFinal(){
      main.style.display = "none";
      finalMain.style.display = "block";
      placeDecor(document.getElementById("decorLayerFinal"));
      // Final albümü default dönsün
    }
    btnFinish.addEventListener("click", () => {
      if(btnFinish.disabled) return;
      goFinal();
    });

    // =============================
    // 5) Album pause on mobile tap + hover
    // =============================
    function bindAlbumToggle(albumEl){
      if(!albumEl) return;
      const toggle = () => albumEl.classList.toggle("paused");
      albumEl.addEventListener("click", toggle, {passive:true});
      albumEl.addEventListener("touchend", (e)=>{ e.preventDefault(); toggle(); }, {passive:false});
    }
    bindAlbumToggle(document.getElementById("albumMain"));
    bindAlbumToggle(document.getElementById("albumFinal"));

    // =============================
    // 6) Decor hearts (optional)
    // =============================
    function rand(min, max){ return Math.random() * (max - min) + min; }

    function makeHeart(idSuffix){
      const wrapper = document.createElement("div");
      wrapper.className = "decorItem";
      wrapper.innerHTML = `
        <div class="heart-container">
          <input id="Give-It-An-Id-${idSuffix}" class="checkbox" type="checkbox">
          <div class="svg-container">
            <svg xmlns="http://www.w3.org/2000/svg" class="svg-outline" viewBox="0 0 24 24">
              <path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,11,8.967a1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,22,8.967C22,11.87,19.053,16.006,13.915,20.313Z"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" class="svg-filled" viewBox="0 0 24 24">
              <path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Z"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" height="100" width="100" class="svg-celebrate">
              <polygon points="10,10 20,20"></polygon>
              <polygon points="10,50 20,50"></polygon>
              <polygon points="20,80 30,70"></polygon>
              <polygon points="90,10 80,20"></polygon>
              <polygon points="90,50 80,50"></polygon>
              <polygon points="80,80 70,70"></polygon>
            </svg>
          </div>
        </div>
      `;
      return wrapper;
    }

    function placeDecor(layer){
      if(!layer) return;
      layer.innerHTML = "";
      const vw = window.innerWidth, vh = window.innerHeight;
      const count = vw < 520 ? 10 : 16;
      const palette = [
        "rgba(240,141,178,.95)",
        "rgba(247,167,196,.95)",
        "rgba(183,155,223,.95)",
        "rgba(122,75,183,.85)"
      ];

      for(let i=0;i<count;i++){
        const h = makeHeart(i+1);
        const size = rand(34,54);
        h.style.width = `${size}px`;
        h.style.height = `${size}px`;
        const c = palette[Math.floor(Math.random()*palette.length)];
        h.querySelector(".heart-container").style.setProperty("--heart-color", c);
        h.style.transform = `rotate(${rand(-18,18)}deg)`;
        h.style.left = `${rand(0.03,0.97)*vw}px`;
        h.style.top  = `${rand(0.05,0.95)*vh}px`;
        layer.appendChild(h);
      }
    }

    window.addEventListener("resize", () => {
      if(main.style.display === "block") placeDecor(document.getElementById("decorLayer"));
      if(finalMain.style.display === "block") placeDecor(document.getElementById("decorLayerFinal"));
    });
  </script>
</body>
</html>
